# KV Schema Extraction

A tool for **schema extraction in key-value databases**, focusing on Redis instances. It analyzes stored keys and values, detects hierarchical keys (e.g., flattened and other patterns) and structured data types (JSON, Hash, List, Set), and generates a JSON Schema-like representation of the inferred database structure.

## Requirements

- Python 3.9+
- Redis (running locally or via Docker)

## Setting Up the Environment

1. **Clone the repository**:

```bash
git clone https://github.com/AlexsandroSchneider/KV-Schema-Extraction.git
cd KV-Schema-Extraction
```

2. **Create a virtual environment**:

```bash
python -m venv venv
```

3. **Activate the virtual environment**:

- **Windows**:
```bash
venv\Scripts\activate
```
- **Linux/macOS**:
```bash
source venv/bin/activate
```

4. **Install the dependencies**:

```bash
pip install -r requirements.txt
```

## Running the Project

Once the environment is set up, run:

```bash
python main.py
```

### Configuration
Project behavior is controlled via the config.ini file.

- `database`: Redis logical database number (0â€“15)
- `batch_size`: Number of keys and values to extract per batch (performance reasons)
- `export_variations`: If `True`, outputs schema variations for further analysis
- `host` and `port`: Define the Redis server connection

## Output Structure

The tool exports a JSON file named `output_schema.json` in the project folder, representing the inferred schema.

## Running Redis with Docker

If Redis is not installed locally, you can run it in a container:

```bash
docker run -d -p 6379:6379 --name redis_kvschema redis/redis-stack:latest
```

> The tool connects by default to `localhost` on port `6379`.

## Synthetic Data Generator
The repository includes a tool named `synthetic_data_generator.py` that generates flattened key names and example values to be inserted into a Redis key-value database based on a valid JSON Schema input file (similar structure to the output generated by the extraction tool).

### Usage
Run it from the terminal:

```bash
python synthethic_data_generator.py
```

You will be prompted to:

1. Provide the input schema file (default: `input_schema.json`)
2. Choose a delimiter for key naming (`:`, `/`, or `.`)
3. Decide whether to include IDs in the key path
4. Choose between generation modes:  
   - **Mode 1**: Multiple instances (first with required fields only, rest mixed)  
   - **Mode 2**: One instance with all fields
5. (If Mode 1) Set number of instances per entity (default: 100)

### Output
The tool creates a Redis-compatible file with SET commands to insert generated keys and values. Default output is `redis_commands.txt`.
You can insert the generated data into Redis using the `redis-cli`:

```bash
redis-cli < redis_commands.txt
```

> An example JSON Schema file named `input_schema.json` is included in the repository for testing purposes.